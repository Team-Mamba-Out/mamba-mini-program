<wxs src="../../utils/messageProcess.wxs" module="utils"></wxs>

<view class="container">
  <!-- é‚®ä»¶å¡ç‰‡ -->
  <view class="email-card">
    <!-- é‚®ä»¶å¤´ -->
    <view class="email-header" wx:if="{{!utils.isUserMessage(message)}}">
      <text class="notification-badge">SYSTEM NOTIFICATION</text>
      <text class="email-title">{{message.title}}</text>
      <view class="meta-info">
        <text class="meta-item">â° {{message.createTime}}</text>
      </view>
    </view>

    <view class="email-header" wx:elif="{{utils.isUserMessage(message)}}">
      <text class="notification-badge">USER MESSAGE</text>
      <text class="email-title">{{message.title}}</text>
      <view class="meta-info">
        <text class="meta-item">â° {{message.createTime}}</text>
        <text class="meta-item">ğŸ“® to Admin</text>
      </view>
    </view>

    <!-- æ­£æ–‡å†…å®¹ -->
    <view class="content-section">
      <!-- æ ¹æ®ä¸åŒç±»å‹æ¶ˆæ¯å±•ç¤ºä¸åŒçš„å†…å®¹ -->
      <view wx:if="{{utils.isRoomReassignment(message)}}">
        <!-- Room Reassignment Notification ç±»å‹ -->
        <view class="info-text-reassign">
          {{message.text}}
        </view>
        <view class="info-card warning">
          <text class="card-title">âš ï¸ Important Change</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <view>
              <view class="info-text">Original Room:</view>
              <text class="info-text">{{utils.parseOriginalRoom(message.text)}}</text>
            </view>
          </view>
          <view class="info-row">
            <text class="icon">ğŸ•°ï¸</text>
            <text class="info-text">Order Time: {{utils.parseOriginalTime(message.text)}}</text>
          </view>
        </view>

        <view class="info-card update">
          <text class="card-title">ğŸ†• New Arrangement</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <view>
              <view class="info-text">New Room:</view>
              <text class="info-text">{{utils.parseNewRoom(message.text)}}</text>
            </view>
          </view>
          <view class="info-row">
            <text class="icon">â³</text>
            <view>
              <view class="info-text">Duration:</view>
              <text class="info-text">{{utils.parseDuration(message.text)}}</text>
            </view>
          </view>
        </view>

        <view class="info-card reason">
          <text class="card-title">ğŸ·ï¸ Change Reason</text>
          <view class="reason-content">{{utils.parseReason(message.text)}}</view>
        </view>

        <view class="buttons">
          <button class="reject {{isButtonDisabled ? 'disabled' : ''}}" disabled="{{isButtonDisabled}}" bindtap="reject">âŒ Decline Change</button>
          <button class="accept {{isButtonDisabled ? 'disabled' : ''}}" disabled="{{isButtonDisabled}}" bindtap="accept">âœ”ï¸ Accept New Room</button>
        </view>
      </view>

      <view wx:elif="{{utils.isRoomReservationSuccessful(message)}}">
        <!-- Reserve Room Successfully ç±»å‹ -->
        <view class="info-card reason">
          <text class="card-title">ğŸ“† Room Reservation</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <view>
              <view class="info-text">Room:</view>
              <text class="info-text">{{utils.parseRoom(message.text)}}</text>
            </view>
          </view>
          <view class="info-row">
            <text class="icon">â³</text>
            <view>
              <view class="info-text">Time:</view>
              <text class="info-text">{{utils.parseTime(message.text)}}</text>
            </view>
          </view>
        </view>
      </view>

      <view wx:elif="{{utils.isRoomReservationCancelled(message)}}">
        <!-- Room Reservation Cancellation ç±»å‹ -->
        <view class="info-card warning">
          <text class="card-title">â­• Reservation Cancelled</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <view>
              <view class="info-text">Room:</view>
              <text class="info-text">{{utils.parseRoom(message.text)}}</text>
            </view>
          </view>
        </view>
      </view>

      <view wx:elif="{{utils.isRoomReservationApproved(message)}}">
        <!-- Room Reservation Approved ç±»å‹ -->
        <view class="info-card reason">
          <text class="card-title">âœ”ï¸ Reservation Approved</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <view>
              <view class="info-text">Room:</view>
              <text class="info-text">{{utils.parseRoom(message.text)}}</text>
            </view>
          </view>
        </view>
      </view>

      <view wx:elif="{{utils.isRoomReservationRejected(message)}}">
        <!-- Room Reservation Rejected ç±»å‹ -->
        <view class="info-card warning">
          <text class="card-title">ğŸš« Reservation Rejected</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <view>
              <view class="info-text">Room:</view>
              <text class="info-text">{{utils.parseRoom(message.text)}}</text>
            </view>
          </view>
        </view>
      </view>

      <view wx:if="{{!utils.isUserMessage(message) && !utils.isRoomReassignment(message)}}" class="info-text">
        {{message.text}}
      </view>

      <view wx:elif="{{utils.isUserMessage(message)}}">
        <!-- ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ -->
        <view class="info-card" wx:if="{{message.type === 1}}">
          <text class="card-title">âš™ï¸ Room Repair</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <text class="info-text-title">Room</text>
          </view>
          <view class="info-text-user">{{rooms[message.roomId-1].roomName}}</view>
          <view class="info-row">
            <text class="icon">ğŸ”¨</text>
            <text class="info-text-title">Problem</text>
          </view>
          <view class="info-text-user">{{message.text}}</view>
        </view>

        <view class="info-card" wx:if="{{message.type === 2}}">
          <text class="card-title">ğŸ“’ Further Reservation</text>
          <view class="info-row">
            <text class="icon">ğŸ«</text>
            <text class="info-text-title">Room</text>
          </view>
          <view class="info-text-user">{{rooms[message.roomId-1].roomName}}</view>
          <view class="info-row">
            <text class="icon">ğŸ“©</text>
            <text class="info-text-title">Comment</text>
          </view>
          <view class="info-text-user">{{message.text}}</view>
        </view>

        <view class="info-card" wx:if="{{message.type === 0}}">
          <text class="card-title">âœ‰ï¸ Feedback Message</text>
          <view class="info-row" wx:if="{{message.roomId}}">
            <text class="icon">ğŸ«</text>
            <text class="info-text-title">Room</text>
          </view>
          <view class="info-text-user" wx:if="{{message.roomId}}">{{rooms[message.roomId-1].roomName}}</view>
          <view class="info-row">
            <text class="icon">ğŸ“ƒ</text>
            <text class="info-text-title">Details</text>
          </view>
          <text class="info-text-user">{{message.text}}</text>
        </view>
      </view>
    </view>

    <!-- å‘ä»¶äººä¿¡æ¯ -->
    <view class="sender-info" wx:if="{{!utils.isUserMessage(message)}}">
      <text class="signature">Best regards,</text>
      <text class="sender-name">{{message.sender}}</text>
      <text class="sender-title">Facility Management Team</text>
    </view>

    <view class="sender-info" wx:if="{{utils.isUserMessage(message)}}">
      <text class="signature">From, </text>
      <text class="sender-name">{{message.sender}}</text>
    </view>
  </view>

  <!-- ç³»ç»ŸLOGO -->
  <view class="system-footer">
    <image src="/img/logo.jpg" class="system-logo" />
    <text class="footer-text">Powered by Room Management System</text>
  </view>
</view>